<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adaptations to the testing procedure for non-normal endpoints • adoptr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Adaptations to the testing procedure for non-normal endpoints">
<meta property="og:description" content="adoptr">
<meta property="og:image" content="https://kkmann.github.io/adoptr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adoptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/adoptr.html">Get started</a>
</li>
<li>
  <a href="../articles/adoptr_jss.html">Overview Paper</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/working-with-priors.html">Working with Priors</a>
    </li>
    <li>
      <a href="../articles/conditional-scores.html">Conditional Scores</a>
    </li>
    <li>
      <a href="../articles/composite-scores.html">Composite Scores</a>
    </li>
    <li>
      <a href="../articles/defining-new-scores.html">Definining New Scores</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kkmann/adoptr" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="other-endpoints_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adaptations to the testing procedure for non-normal endpoints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kkmann/adoptr/blob/HEAD/vignettes/other-endpoints.Rmd" class="external-link"><code>vignettes/other-endpoints.Rmd</code></a></small>
      <div class="hidden name"><code>other-endpoints.Rmd</code></div>

    </div>

    
    
<p>Currently, <code>adoptr</code> supports the optimization of adaptive two-stage designs with either normally or t-distributed test statistics. More specifically, it is required that the first stage test statistic, and the distribution of the second stage test-statistic conditional on the first-stage test statistic, is either normal or t-distributed.</p>
<p>When individual observations are normally distributed, stage-wise Z- or T-test statistics fulfill these criteria. In practice, however, there are many situations where one cannot reasonably assume that individual observations are sampled from a normal distribution. It is common for trials to be conducted for binary or time-to-event endpoints, e.g. if one is interested in investigating the impact of a drug on mortality. One way to deal with this situation is by transforming the data to a test-statistic which is approximately normal. In the following, we will explain how to do so for binary and for time-to-event endpoints.</p>
<p>We will be using the following notation:</p>
<ul>
<li>
<span class="math inline">\(X_i^T\)</span> will denote an observation of recruit <span class="math inline">\(i\)</span> in the treatment arm</li>
<li>
<span class="math inline">\(X_i^C\)</span> will denote the observation of recruit <span class="math inline">\(i\)</span> in the control arm</li>
<li>
<span class="math inline">\(n\)</span> will denote the group-wise sample size.</li>
</ul>
<div class="section level2">
<h2 id="binary-endpoints">Binary Endpoints<a class="anchor" aria-label="anchor" href="#binary-endpoints"></a>
</h2>
<p>Binary endpoints are endpoints where individual observations follow a Bernoulli distribution, i.e. <span class="math inline">\(X_i^T \sim Bin(1,p_T)\)</span> and <span class="math inline">\(X_i^C\sim Bin(1,p_C)\)</span>. Our goal is to compare the probability <span class="math inline">\(p_T\)</span> of an event in the treatment group with a fixed value (single-arm trial) or with the probability <span class="math inline">\(p_C\)</span> of an event in the control group (two-armed trial). Thus, assuming that larger probabilities are favorable, we have</p>
<p><span class="math display">\[
H_0: p_T \leq p_C\quad \text{vs.} \quad H_1:p_T &gt; p_C.
\]</span></p>
<p>To test this hypothesis, one could use the test statistic <span class="math display">\[
U=\sqrt{\frac{n}{2}}\frac{\hat{p}_T-\hat{p}_C}{\sqrt{\hat{p}_0(1-\hat{p}_0)}},
\]</span></p>
<p>where <span class="math inline">\(\hat{p}_T=\frac{1}{n}\sum_i^{n}X_i^T\)</span> and <span class="math inline">\(\hat{p}_C=\frac{1}{n}\sum_i^{n}X_i^C\)</span> are the maximum likelihood estimators of <span class="math inline">\(p_T\)</span> and <span class="math inline">\(p_C\)</span> and where <span class="math inline">\(\hat{p}_0=\frac{\frac{1}{n}\sum_i^{n}X_i^T+\frac{1}{n}\sum_i^{n}X_i^C}{2}\)</span>.</p>
<p>The outcome of <span class="math inline">\(U\)</span> is then compared to <span class="math inline">\(c_f\)</span> and <span class="math inline">\(c_e\)</span>, the first stage boundaries. If <span class="math inline">\(U\in [c_f,c_e]\)</span>, we continue the trial and compute a new value for <span class="math inline">\(U_2\)</span> in the second stage, where we reject the null if <span class="math inline">\(U_2&gt;c_2\)</span>.</p>
<p>It is a well-known fact that this test statistic is asymptotically normal, and we will give a proof of this in the next section.</p>
<div class="section level3">
<h3 id="asymptotic-distribution-of-the-test-statistic">Asymptotic Distribution of the Test Statistic<a class="anchor" aria-label="anchor" href="#asymptotic-distribution-of-the-test-statistic"></a>
</h3>
<p>We begin with the difference <span class="math inline">\(\hat{p}_T-\hat{p}_C\)</span>. Using the de Moivre-Laplace theorem, we get that <span class="math display">\[
\frac{n\hat{p}_T-np_T}{\sqrt{n}} \overset{d}{\to} \mathcal{N}(0,p_T(1-p_T)).
\]</span> After defining <span class="math inline">\(\sigma_A^2=p_T(1-p_T)+p_C(1-p_C)\)</span>, we obtain <span class="math display">\[
\frac{n\hat{p}_T-np_T}{\sqrt{n}}-\frac{n\hat{p}_C-np_C}{\sqrt{n}}=\sqrt{n}(\hat{p}_T-\hat{p}_C-(p_T-p_C))\overset{d}{\to}\mathcal{N}(0,\sigma_A^2),
\]</span> so it follows <span class="math display">\[
\sqrt{n}(\hat{p}_T-\hat{p}_C)\overset{d}{\to}\mathcal{N}(\sqrt{n}(p_T-p_c),\sigma_A^2).
\]</span> Applying the continuous mapping theorem, it results that <span class="math inline">\(\hat{\sigma}_0:=\sqrt{2\hat{p}_0(1-\hat{p}_0)} \overset{P}{\to}\sqrt{2p_0(1-p_0)}:=\sigma_0\)</span>, so by Slutzky’s theorem, we get <span class="math display">\[
\frac{\sqrt{n}(\hat{p}_T-\hat{p}_C)}{\sigma_0}=\sqrt{\frac{n}{2}}\frac{\hat{p}_T-\hat{p}_C}{\sqrt{\hat{p}_0(1-\hat{p}_0)}}\overset{d}{\to}\mathcal{N}\left(\sqrt{n}\frac{p_T-p_C}{\sigma_0},\frac{\sigma_A^2}{\sigma_0^2}\right).
\]</span> Hence, for sufficiently large <span class="math inline">\(n\)</span>, <span class="math inline">\(U\)</span> is approximately normal.</p>
<p>Note that under the null hypothesis, <span class="math inline">\(\sigma_A^2=\sigma_0^2\)</span> and <span class="math inline">\(p_T=p_C\)</span>. Thus, approximately, <span class="math inline">\(U\sim \mathcal{N}(0,1)\)</span> under <span class="math inline">\(H_0\)</span>.</p>
</div>
<div class="section level3">
<h3 id="adoptr-and-binomial-endpoints">
<code>adoptr</code> and Binomial Endpoints<a class="anchor" aria-label="anchor" href="#adoptr-and-binomial-endpoints"></a>
</h3>
<div class="section level4">
<h4 id="implementation-details">Implementation Details<a class="anchor" aria-label="anchor" href="#implementation-details"></a>
</h4>
<p>Currently, <code>adoptr</code> only supports the specification of a single fixed reference value fo <span class="math inline">\(p_C\)</span>, while general prior distributions are supported for the effect size <span class="math inline">\(\theta\)</span>.</p>
<p>This is a limitation, as uncertainty about the control group rate cannot be represented in this framework. However, in a trial comparing a new treatment to an existing one, it is usually reasonable to assume that some information about the event rate in the control group is available beforehand.</p>
</div>
<div class="section level4">
<h4 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<p>Assume we want to plan a two-armed trial with an assumed rate of events in the control group of <span class="math inline">\(p_C=0.3\)</span>. These parameters are encoded in the <code>DataDistribution</code> object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datadist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BinomialDataDistribution-class.html">Binomial</a></span><span class="op">(</span><span class="fl">0.3</span>, two_armed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Let us furthermore postulate a normal prior distribution for <span class="math inline">\(\theta\)</span> with expectation <span class="math inline">\(\mu=0.2\)</span> and standard deviation <span class="math inline">\(\sigma=0.2\)</span>, which was truncated to the interval <span class="math inline">\((-.29,0.69)\)</span>. It is necessary to use a truncation to ensure that <span class="math inline">\(p_T \in (0,1)\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_0</span>        <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">.0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">prior</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ContinuousPrior-class.html">ContinuousPrior</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fl">0.69</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.29</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                              support <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.29</span>,<span class="fl">0.69</span><span class="op">)</span>,</span>
<span>                              tighten_support <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We require a maximal type one error of <span class="math inline">\(\alpha\leq 0.025\)</span> and a minimum expected power of <span class="math inline">\(\mathbb{E}[1-\beta]\geq 0.8\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span>      <span class="op">&lt;-</span> <span class="fl">0.025</span></span>
<span><span class="va">min_epower</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">toer_cnstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="va">datadist</span>, <span class="va">H_0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">alpha</span></span>
<span><span class="va">epow_cnstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="va">datadist</span>, <span class="fu"><a href="../reference/condition.html">condition</a></span><span class="op">(</span><span class="va">prior</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.69</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">min_epower</span></span></code></pre></div>
<p>Next, we need to choose an objective function, which will be the expected sample size under the chosen prior distribution for <span class="math inline">\(\theta\)</span> in this example. After having chosen a starting point for the optimization procedure, we use the <code>minimize</code> function to determine the optimal design parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ess</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ExpectedSampleSize</a></span><span class="op">(</span><span class="va">datadist</span>,<span class="va">prior</span><span class="op">)</span></span>
<span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_initial_design.html">get_initial_design</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.025</span>,<span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">opt_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/minimize.html">minimize</a></span><span class="op">(</span><span class="va">ess</span>,<span class="fu"><a href="../reference/subject_to.html">subject_to</a></span><span class="op">(</span><span class="va">toer_cnstr</span>,<span class="va">epow_cnstr</span><span class="op">)</span>,initial_design <span class="op">=</span> <span class="va">init</span>, check_constraints <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">opt_design</span><span class="op">$</span><span class="va">design</span><span class="op">)</span></span></code></pre></div>
<p><img src="other-endpoints_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="time-to-event-endpoints">Time-to-Event Endpoints<a class="anchor" aria-label="anchor" href="#time-to-event-endpoints"></a>
</h2>
<p>Time-to-event endpoints are another common type of endpoint used in clinical trials. Time-to-event data is two dimensional and consists of an indicator denoting the occurrence of an event or censoring, and a time of the event or censoring.</p>
<p>A common effect measure for time-to-event endpoints is the so called hazard-ratio, which is the ratio of hazard functions between two groups or the ratio of the hazard of one group and a postulated baseline hazard.</p>
<p>In the following, the hazard ratio will be denoted by <span class="math inline">\(\theta := \frac{\lambda_C(t)}{\lambda_T(t)}\)</span>, and we will assume that <span class="math inline">\(\theta\)</span> is constant over time. Assuming that less hazard is favorable, the resulting hypotheses to be tested are</p>
<p><span class="math display">\[
H_0: \theta\leq 1 \quad \text{vs.} \quad H_1: \theta &gt;1.
\]</span></p>
<p>Let <span class="math inline">\(1,\dots,J\)</span> be the distinct times of observed events in either group and let <span class="math inline">\(n_{T,j}, n_{C,j}\)</span> be the number of subjects, who neither had an event nor have been censored. Additionally, let <span class="math inline">\(O_{T,j},O_{C,j}\)</span> denote the observed number of events at time <span class="math inline">\(j\)</span>. In the following we assume that there are no ties, so <span class="math inline">\(O_{T,j},O_{C,j}\in \{0,1\}\)</span>. Define <span class="math inline">\(n_j:=n_{T,j}+n_{C,j}\)</span> and <span class="math inline">\(O_j:= O_{T,j}+O_{C,j}\)</span>. Under the null, the hazard functions of the groups are equal. Thus, for <span class="math inline">\(i \in \{T,C\}\)</span>, <span class="math inline">\(O_{j}\)</span> can be regarded as the number of events in a draw of size <span class="math inline">\(n_{i,j}\)</span>, where the population has size <span class="math inline">\(n_j\)</span>. Therefore, <span class="math inline">\(O_{i,j}\)</span> follows a hypergeometric distribution, i.e. <span class="math inline">\(O_{i,j}\sim h(n_j,O_j,n_{i,j})\)</span>. This distribution has an expected value of <span class="math inline">\(E_{i,j}:=\mathbb{E}[O_{i,j}]=n_{i,j}\frac{O_j}{n_j}\)</span> and variance <span class="math inline">\(V_{i,j}:=\text{Var}(O_{i,j})=E_{i,j}(\frac{n_j-O_j}{n_j})(\frac{n_j-n_{i,j}}{n_j-1})\)</span>. Using these definitions, we can define the so-called  test statistc as</p>
<p><span class="math display">\[
L=L_T:=\frac{\sum_{j=1}^J O_{T,j}-E_{T,j}}{\sqrt{\sum_{j=1}^J V_{T,j}}}.
\]</span> Note that it does not matter whether we consider <span class="math inline">\(L_T\)</span> or the analogously defined statistic <span class="math inline">\(L_C\)</span>, both of them yield the same results, so we abbreviate <span class="math inline">\(L_T\)</span> to <span class="math inline">\(L\)</span>. By the central limit theorem, it is easy to see that <span class="math inline">\(L \overset{d}{\to} \mathcal{N}(0,1)\)</span>. Under the alternative, it can be shown that, approximately, <span class="math inline">\(L \sim \mathcal{N}(\text{log}(\theta)\frac{1}{2}\sqrt{J},1)\)</span>. If <span class="math inline">\(d\)</span> is the average probability of and event per recruit in both arms (also known as the event rate), <span class="math inline">\(J\)</span> can be replaced by <span class="math inline">\(2 \cdot n \cdot d\)</span> (where <span class="math inline">\(n\)</span> denotes, like in the previous sections, the number of recruits per group). Thus, by by postulating an event probability, we can calculate the number of recruits per groups that would be required to achieve a specific number of events, and by extensions, a specific power. In <code>adoptr</code>, the parameter <span class="math inline">\(d\)</span> needs to be pre-specified in order to obtain a one-parametric distribution (the other parameter being <span class="math inline">\(\theta\)</span>), and <span class="math inline">\(d\)</span> is assumed to be fixed over time. This is similar to the case of binary endpoints, where the response rate in the control group <span class="math inline">\(p_C\)</span> had to be a constant value.</p>
<div class="section level3">
<h3 id="survival-analysis-and-adaptive-designs">Survival Analysis and Adaptive Designs<a class="anchor" aria-label="anchor" href="#survival-analysis-and-adaptive-designs"></a>
</h3>
<div class="section level4">
<h4 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h4>
<p>We expand the previous notation by an index <span class="math inline">\(k\in \{1,2\}\)</span> denoting the current stage. We observe <span class="math inline">\(J_1\)</span> events until the interim analysis, and we observe <span class="math inline">\(J_2\)</span> events in total until the final analysis. We stress that, in this notation, <span class="math inline">\(J_2\)</span> denotes the cumulative number of events in both stages. Furthermore, let <span class="math inline">\(O_{i,j,k}\)</span> be the number of observed events in arm <span class="math inline">\(i\in \{T,C\}\)</span> at time <span class="math inline">\(j \in \{1,\dots,J_k\}\)</span> in stage <span class="math inline">\(k \in \{1,2\}\)</span>. Like in the previous section, let <span class="math inline">\(E_{i,j,k}= \mathbb{E}[O_{i,j,k}]=n_{i,j,k}\frac{O_{j,k}}{n_{j,k}}\)</span>, where <span class="math inline">\(n_{i,j,k}\)</span> is the number of patients that have not had an event until the end of stage <span class="math inline">\(k\)</span>, and let <span class="math inline">\(O_{j,k}=O_{T,j,k}+O_{C,j,k}\)</span> and <span class="math inline">\(n_{j,k}=n_{T,j,k}+n_{C,j,k}\)</span>. Likewise, we can define <span class="math inline">\(V_{i,j,k}\)</span> analogously to the previous section. The cumulative log-rank test statistic up to stage <span class="math inline">\(k \in \{1, 2\}\)</span> can then be defined as <span class="math display">\[
L_k=\frac{\sum_{j=1}^{J_k} O_{T,j,k}-E_{T,j,k}}{\sqrt{\sum_{j=1}^{J_k} V_{T,j,k}}}.
\]</span></p>
</div>
<div class="section level4">
<h4 id="dependency-issues-and-solutions">Dependency Issues and Solutions<a class="anchor" aria-label="anchor" href="#dependency-issues-and-solutions"></a>
</h4>
<p>For normal distributed endpoints, the stage-wise test statistics come from independent cohorts, which makes the calculation of their joint distributions straightforward.</p>
<p>In survival analysis, it is possible to have patients that have been recruited during the first stage, but have not had an event at the point of the interim analysis. Those provide information for both stages: in the first stage, we know that they survived, and in the second stage, they might die or even survive until the end of the trial. This makes the construction of a pair of suitable test statistics more challenging.</p>
<p>Therefore, the construction of stage-wise test statistics which use all available, but no double-counted information contain the same inform</p>
<p>In the following, we will present two methods to avoid these issues.</p>
<div class="section level5">
<h5 id="solution-1-independent-increments">Solution 1: Independent Increments<a class="anchor" aria-label="anchor" href="#solution-1-independent-increments"></a>
</h5>
<p>It can be shown that the following statistic</p>
<p><span class="math display">\[
Z_2:= \frac{\sqrt{J_2}L_2-\sqrt{J_1}L_1}{\sqrt{J_2-J_1}}
\]</span> is approximately standard normal under the null, <span class="math inline">\(Z_2\sim \mathcal{N}(\text{log}(\theta)\frac{1}{2}\sqrt{J_2-J_1},1)\)</span> and <span class="math inline">\(L_1\)</span> and <span class="math inline">\(Z_2\)</span> are approximately independent. Thus, <span class="math inline">\(Z_2\)</span> has the same distribution as the stage-wise (non-accumulative) test statistic of the second stage <span class="math inline">\(L_{\Delta}\)</span> and as <code>adoptr</code> assumes independence between the stage-wise test statistics, we can use <span class="math inline">\(Z_2\)</span> as a replacement of <span class="math inline">\(L_{\Delta}\)</span>.</p>
<p>In the following, we denote the in-built <code>adoptr</code>functions to get the sample sizes by <span class="math inline">\(\texttt{n1}\)</span> and <span class="math inline">\(\texttt{n2}\)</span>.</p>
<p>The procedure is now as follows:</p>
<p>During the accrual time, recruit approximately <span class="math inline">\(\frac{\texttt{n1}}{d}\)</span> patients per group and conduct the interim analysis after <span class="math inline">\(2\cdot \texttt{n_1}\)</span> events have been observed overall. Assume, <span class="math inline">\(q\)</span> patients have not had an event until the interim analysis. These patients are censored for the computation of <span class="math inline">\(L_1\)</span>.</p>
<p>After the interim analysis, we have <span class="math inline">\(2\cdot \texttt{n2}(L_1)\)</span> events that should be ovserved during the second stage. But of course, <span class="math inline">\(q\)</span> patients are still in the trial, so we only need to recruit <span class="math inline">\(\frac{2\cdot \texttt{n2}(L_1)}{d}-q\)</span> new people.</p>
<p>When the required number of events have been observed in the second stage, we now conduct the final analysis using <span class="math inline">\(Z_2\)</span> instead of <span class="math inline">\(L_{\Delta}\)</span>.</p>
</div>
<div class="section level5">
<h5 id="solution-2-left-truncation-at-the-second-stage">Solution 2: Left Truncation at the Second Stage<a class="anchor" aria-label="anchor" href="#solution-2-left-truncation-at-the-second-stage"></a>
</h5>
<p>Another approach uses left truncation and right censoring. In the following, <span class="math inline">\(R_i\)</span> stands for the calendar time of entry for individual <span class="math inline">\(i\)</span>. Furthermore, let <span class="math inline">\(T_i\)</span> be its time from entry to the event and <span class="math inline">\(C_i\)</span> its time from entry to censoring. Assume that these values are independent and let <span class="math inline">\(r_i,t_i,c_i\)</span> be realizations of <span class="math inline">\(R_i,T_i\)</span> and <span class="math inline">\(C_i\)</span>. Additionally, we denote the calendar time of the interim analysis by <span class="math inline">\(t_{Int}\)</span> and the calender time of the final analysis by <span class="math inline">\(t_{Fin}\)</span>.</p>
<p>In the following, it is important to remember <span class="math inline">\(n_{j,k}\)</span> which was defined to be the cardinality of the risk set, which is the number of patients at risk at time <span class="math inline">\(j\)</span> in stage <span class="math inline">\(k\)</span>. This value is important for the calculation of the log-rank test statistics.</p>
<p>Let <span class="math inline">\(i\)</span> be recruited before the interim analysis. Now define <span class="math inline">\(y_{i,1}:=\min \{t_i,c_i,t_{Int}\}\)</span>, so <span class="math inline">\(y_{i,1}\)</span> can be interpreted as the minimum time until “something” happens to individual <span class="math inline">\(i\)</span> in the first stage (either the interim analysis is conducted, <span class="math inline">\(i\)</span> had an event or it was censored). The risk interval is now defined to be <span class="math inline">\((0,y_{i,1})\)</span>, which means that that individual <span class="math inline">\(i\)</span> belongs to the risk set at the event time <span class="math inline">\(t_j\)</span> if <span class="math inline">\(\min \{c_i,t_{Int}-r_i\}\geq x_j\)</span>. Therefore, the first stage analysis is done in the usual way.</p>
<p>If <span class="math inline">\(i\)</span> has not had an event yet or was recruited in the second stage, we define <span class="math inline">\(y_{i,2}:=\min\{t_i,c_i,t_{Fin}\}\)</span>. As before, <span class="math inline">\(y_{i,2}\)</span> can be interpreted as the minimum time until something happens to individual <span class="math inline">\(i\)</span> in the second stage: Either the final analysis is conducted, <span class="math inline">\(i\)</span> had an event or it was censored. As the second test statistic is cumulative, one should expect the risk interval to be <span class="math inline">\((0,y_{i,2})\)</span>, but actually, it is defined as <span class="math inline">\((t_{Int}-r_i,y_{i,2})\)</span>. This is due to the fact that a patient <span class="math inline">\(j\)</span> which was recruited in the first stage, but had no event until the interim analysis, has already provided the information of “no event” in the time span <span class="math inline">\((t_{Int}-r_i,t_{Int})\)</span> for the interim. To avoid double-counting in the second analysis, we say that this patient is not in the risk set until this time span is over.</p>
<p>Actually, it can be shown that the resulting test statistics <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_{Trunc}\)</span> (the statistic of the final analysis) are independent, so methods from <code>adoptr</code> can be applied.</p>
<p>One may conduct the trial according to the following instructions:</p>
<p>For the interim, the procedure is the same as for the independent increment solution, but it is important to know the time span the subjects have been in the trial until the analysis is conducted.</p>
<p>After the interim analysis, we have <span class="math inline">\(2\cdot \texttt{n2}(L_1)\)</span> events that should be observed during the second stage. But under the assumption that <span class="math inline">\(q\)</span> patients have not had an event yet, we only need to recruit <span class="math inline">\(\frac{2\cdot \texttt{n2}(L_1)}{d}-q\)</span> new people.</p>
<p>The test statistic of the final analysis <span class="math inline">\(L_{Trunc}\)</span> is not computed in the usual way, but <span class="math inline">\(n_{j,k}\)</span> now depends on whether a subject has had an event at the interim analysis, so recruit <span class="math inline">\(i\)</span> is in the risk set if <span class="math inline">\(t_{Int}-r_i &lt; j \leq y_{i,2}\)</span>. After having calculated <span class="math inline">\(L_{Trunc}\)</span> this way, we can now use this test statistic instead of <span class="math inline">\(L_\Delta\)</span> for the final analysis.</p>
</div>
</div>
<div class="section level4">
<h4 id="adoptrand-time-to-event-endpoints">
<code>adoptr</code>and Time-to-event endpoints<a class="anchor" aria-label="anchor" href="#adoptrand-time-to-event-endpoints"></a>
</h4>
<p>In <code>adoptr</code>, trial designs to investigate time-to-event endpoints can be represented in objects of the class <code>SurvivalDesign</code>. These designs consist of first stage futility and efficacy boundary <span class="math inline">\(c_f\)</span> and <span class="math inline">\(c_e\)</span>, the number of events to observe until the conduction of the interim analysis <span class="math inline">\(n_1\)</span> (or <span class="math inline">\(2\cdot n_1}\)</span> for two-armed trials), the second stage efficacy boundary <span class="math inline">\(c_2\)</span>, the number of events to be observed in the second stage <span class="math inline">\(n_2\)</span> (or <span class="math inline">\(2 \cdot n_2\)</span> for two-armed trials), and the postulated rate of events <span class="math inline">\(d\)</span>.</p>
<p>Let us say we want to plan a two-armed trial trial, where we assume an average rate of events of <span class="math inline">\(d=0.7\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datadist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SurvivalDataDistribution-class.html">Survival</a></span><span class="op">(</span><span class="fl">0.7</span>, two_armed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The postulated rate of events <span class="math inline">\(d\)</span> is saved in the <code>DataDistribution</code> object and will be handed down to any design optimized with respect to this distribution. It will be used to convert the required number of events <span class="math inline">\(n_2\)</span> to the estimated number of required recruits <span class="math inline">\(N_2\)</span> via <span class="math inline">\(N_2 = n_2 / d\)</span>, but it has no other uses. All other design parameters are invariant with respect to the choice of <span class="math inline">\(d\)</span>.</p>
<p>Effect sizes for time-to-event trials are formulated with respect to a hazard ratio. For our example, we assume <span class="math inline">\(\theta=1\)</span> for the null hypothesis, and a point alternative hypothesis of <span class="math inline">\(\theta=1.7\)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">H_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">1.7</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Our desired design should have a maximal type I error <span class="math inline">\(\alpha\leq 0.025\)</span> and a minimum power of <span class="math inline">\((1-\beta)\geq 0.8\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.025</span></span>
<span><span class="va">min_power</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">toer_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="va">datadist</span>,<span class="va">H_0</span><span class="op">)</span><span class="op">&lt;=</span><span class="va">alpha</span></span>
<span><span class="va">pow_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="va">datadist</span>,<span class="va">H_1</span><span class="op">)</span><span class="op">&gt;=</span><span class="va">min_power</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>exp_no_events &lt;-<span class="st"> </span><span class="kw">ExpectedNumberOfEvents</span>(datadist,H_<span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>init &lt;-<span class="st"> </span><span class="kw">get_initial_design</span>(<span class="fl">1.7</span>,<span class="fl">0.025</span>,<span class="fl">0.2</span>,<span class="dt">dist=</span>datadist)</span>
<span id="cb8-3"><a href="#cb8-3"></a>opt_survival &lt;-<span class="st"> </span><span class="kw">minimize</span>(exp_no_events,<span class="kw">subject_to</span>(toer_con,pow_con),<span class="dt">initial_design =</span> init,<span class="dt">check_constraints=</span><span class="ot">TRUE</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">summary</span>(opt_survival<span class="op">$</span>design)</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; For two-armed trials: nevs denotes half of the overall number of required events. nrec denotes the resulting group-wise sample size.</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; </span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; TwoStageDesignSurvival: nevs1= 32 --&gt; nrec1= 46</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; </span></span>
<span id="cb8-10"><a href="#cb8-10"></a>          futility <span class="op">|</span><span class="st">                  </span>continue                 <span class="op">|</span><span class="st"> </span>efficacy</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12"></a>      x1<span class="op">:</span><span class="st">     </span><span class="fl">0.79</span> <span class="op">|</span><span class="st">  </span><span class="fl">0.83</span>  <span class="fl">0.98</span>  <span class="fl">1.24</span>  <span class="fl">1.54</span>  <span class="fl">1.85</span>  <span class="fl">2.10</span>  <span class="fl">2.25</span> <span class="op">|</span><span class="st">  </span><span class="fl">2.29</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; </span></span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="kw">c2</span>(x1)<span class="op">:</span><span class="st">     </span><span class="op">+</span><span class="ot">Inf</span> <span class="op">|</span><span class="st"> </span><span class="fl">+2.17</span> <span class="fl">+2.02</span> <span class="fl">+1.77</span> <span class="fl">+1.43</span> <span class="fl">+1.00</span> <span class="fl">+0.52</span> <span class="fl">+0.07</span> <span class="op">|</span><span class="st">  </span><span class="op">-</span><span class="ot">Inf</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt; </span></span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="kw">nevs2</span>(x1)<span class="op">:</span><span class="st">     </span><span class="dv">0</span> <span class="op">|</span><span class="st">    </span><span class="dv">45</span>    <span class="dv">42</span>    <span class="dv">38</span>    <span class="dv">32</span>    <span class="dv">24</span>    <span class="dv">17</span>    <span class="dv">12</span> <span class="op">|</span><span class="st">     </span><span class="dv">0</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt; </span></span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="kw">nrec2</span>(x1)<span class="op">:</span><span class="st">     </span><span class="dv">0</span> <span class="op">|</span><span class="st">    </span><span class="dv">64</span>    <span class="dv">60</span>    <span class="dv">54</span>    <span class="dv">45</span>    <span class="dv">35</span>    <span class="dv">25</span>    <span class="dv">17</span> <span class="op">|</span><span class="st">     </span><span class="dv">0</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt; </span></span></code></pre></div>
<p>It should be noted that the number of required events <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> are the important information thresholds to be adhered to for testing purposes, while <span class="math inline">\(N_1\)</span> and <span class="math inline">\(N_2\)</span> just serve as rough estimates for the required number of subjects to reach these milestones. If additional information about e.g. time-dependence of baseline hazards is available, it may be worthwhile to use a more sophisticated approach than the <span class="math inline">\(N_2 = n_2 / d\)</span> formula to estimate the number of required subjects.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kevin Kunzmann, Maximilian Pilz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f5b8253ef131d8de31a2e0e075678ba8',
    indexName: 'adoptr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
